import{B as pe,I as X,r as ye,a as ge}from"./buttonIcon-Beq2DGJD.js";import{g as Ce,L as be,t as Ee,D as Y,n as ve}from"./wrapEmojiText-C9ZwzJ29.js";import{au as Le,a as we,av as z,Q as se,ak as A,V as Se,O as _,bR as Ae,L as $,Y as xe,X as Z,b8 as Pe,bS as Q,cr as m,E as Oe,at as H,e as oe,ai as ke,i as J,as as B,j as Te,f as Ne,a5 as Fe}from"./index-CvWBhmNo.js";import{a as N,d as Ie}from"./page-9xzdIDLN.js";import{S as Me}from"./scrollable-COTa0yl_.js";function De(n){if(n.key==="Enter"&&!Le&&!n.isComposing){if(we.settings.sendShortcut==="enter")return n.shiftKey||n.ctrlKey||n.metaKey?void 0:!0;{const t=z?n.metaKey:n.ctrlKey;if(n.shiftKey||(z?n.ctrlKey:n.metaKey))return;if(t)return!0}}return!1}function pt(n){n.requestFullscreen?n.requestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullscreen?n.webkitRequestFullscreen():n.msRequestFullscreen&&n.msRequestFullscreen()}function yt(){document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()}function He(n,t,e){const s=e?e.add(n):n.addEventListener.bind(n);"webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange".split(" ").forEach(i=>{s(i,t,!1)})}function le(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement}function gt(){return!!le()}const Be=["allowfullscreen","async","autofocus","autoplay","checked","controls","default","disabled","formnovalidate","hidden","indeterminate","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","seamless","selected"],$e=new Set(["className","value","readOnly","formNoValidate","isMap","noModule","playsInline",...Be]),Re=new Set(["innerHTML","textContent","innerText","children"]),Ue=Object.assign(Object.create(null),{className:"class",htmlFor:"for"}),We=Object.assign(Object.create(null),{class:"className",formnovalidate:{$:"formNoValidate",BUTTON:1,INPUT:1},ismap:{$:"isMap",IMG:1},nomodule:{$:"noModule",SCRIPT:1},playsinline:{$:"playsInline",VIDEO:1},readonly:{$:"readOnly",INPUT:1,TEXTAREA:1}});function _e(n,t){const e=We[n];return typeof e=="object"?e[t]?e.$:void 0:e}const Ke=new Set(["beforeinput","click","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"]),je=new Set(["altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignObject","g","glyph","glyphRef","hkern","image","line","linearGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","set","stop","svg","switch","symbol","text","textPath","tref","tspan","use","view","vkern"]),Ge={xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"};function qe(n,t,e){let s=e.length,i=t.length,l=s,r=0,o=0,c=t[i-1].nextSibling,f=null;for(;r<i||o<l;){if(t[r]===e[o]){r++,o++;continue}for(;t[i-1]===e[l-1];)i--,l--;if(i===r){const h=l<s?o?e[o-1].nextSibling:e[l-o]:c;for(;o<l;)n.insertBefore(e[o++],h)}else if(l===o)for(;r<i;)(!f||!f.has(t[r]))&&t[r].remove(),r++;else if(t[r]===e[l-1]&&e[o]===t[i-1]){const h=t[--i].nextSibling;n.insertBefore(e[o++],t[r++].nextSibling),n.insertBefore(e[--l],h),t[i]=e[l]}else{if(!f){f=new Map;let d=o;for(;d<l;)f.set(e[d],d++)}const h=f.get(t[r]);if(h!=null)if(o<h&&h<l){let d=r,g=1,E;for(;++d<i&&d<l&&!((E=f.get(t[d]))==null||E!==h+g);)g++;if(g>h-o){const O=t[r];for(;o<h;)n.insertBefore(e[o++],O)}else n.replaceChild(e[o++],t[r++])}else r++;else t[r++].remove()}}}const ee="_$DX_DELEGATE";function Ve(n,t,e,s={}){let i;return se(l=>{i=l,t===document?n():U(t,n(),t.firstChild?null:void 0,e)},s.owner),()=>{i(),t.textContent=""}}function Ct(n,t,e){let s;const i=()=>{const r=document.createElement("template");return r.innerHTML=n,e?r.content.firstChild.firstChild:r.content.firstChild},l=t?()=>_(()=>document.importNode(s||(s=i()),!0)):()=>(s||(s=i())).cloneNode(!0);return l.cloneNode=l,l}function Xe(n,t=window.document){const e=t[ee]||(t[ee]=new Set);for(let s=0,i=n.length;s<i;s++){const l=n[s];e.has(l)||(e.add(l),t.addEventListener(l,st))}}function R(n,t,e){e==null?n.removeAttribute(t):n.setAttribute(t,e)}function Ye(n,t,e,s){s==null?n.removeAttributeNS(t,e):n.setAttributeNS(t,e,s)}function ze(n,t){t==null?n.removeAttribute("class"):n.className=t}function Ze(n,t,e,s){if(s)Array.isArray(e)?(n[`$$${t}`]=e[0],n[`$$${t}Data`]=e[1]):n[`$$${t}`]=e;else if(Array.isArray(e)){const i=e[0];n.addEventListener(t,e[0]=l=>i.call(n,e[1],l))}else n.addEventListener(t,e)}function Qe(n,t,e={}){const s=Object.keys(t||{}),i=Object.keys(e);let l,r;for(l=0,r=i.length;l<r;l++){const o=i[l];!o||o==="undefined"||t[o]||(te(n,o,!1),delete e[o])}for(l=0,r=s.length;l<r;l++){const o=s[l],c=!!t[o];!o||o==="undefined"||e[o]===c||!c||(te(n,o,!0),e[o]=c)}return e}function Je(n,t,e){if(!t)return e?R(n,"style"):t;const s=n.style;if(typeof t=="string")return s.cssText=t;typeof e=="string"&&(s.cssText=e=void 0),e||(e={}),t||(t={});let i,l;for(l in e)t[l]==null&&s.removeProperty(l),delete e[l];for(l in t)i=t[l],i!==e[l]&&(s.setProperty(l,i),e[l]=i);return e}function et(n,t={},e,s){const i={};return s||A(()=>i.children=P(n,t.children,i.children)),A(()=>t.ref&&t.ref(n)),A(()=>tt(n,t,e,!0,i,!0)),i}function bt(n,t,e){return _(()=>n(t,e))}function U(n,t,e,s){if(e!==void 0&&!s&&(s=[]),typeof t!="function")return P(n,t,s,e);A(i=>P(n,t(),i,e),s)}function tt(n,t,e,s,i={},l=!1){t||(t={});for(const r in i)if(!(r in t)){if(r==="children")continue;i[r]=ne(n,r,null,i[r],e,l)}for(const r in t){if(r==="children")continue;const o=t[r];i[r]=ne(n,r,o,i[r],e,l)}}function nt(n){let t,e;return!m.context||!(t=m.registry.get(e=ot()))?n():(m.completed&&m.completed.add(t),m.registry.delete(e),t)}function it(n){return n.toLowerCase().replace(/-([a-z])/g,(t,e)=>e.toUpperCase())}function te(n,t,e){const s=t.trim().split(/\s+/);for(let i=0,l=s.length;i<l;i++)n.classList.toggle(s[i],e)}function ne(n,t,e,s,i,l){let r,o,c,f,h;if(t==="style")return Je(n,e,s);if(t==="classList")return Qe(n,e,s);if(e===s)return s;if(t==="ref")l||e(n);else if(t.slice(0,3)==="on:"){const d=t.slice(3);s&&n.removeEventListener(d,s),e&&n.addEventListener(d,e)}else if(t.slice(0,10)==="oncapture:"){const d=t.slice(10);s&&n.removeEventListener(d,s,!0),e&&n.addEventListener(d,e,!0)}else if(t.slice(0,2)==="on"){const d=t.slice(2).toLowerCase(),g=Ke.has(d);if(!g&&s){const E=Array.isArray(s)?s[0]:s;n.removeEventListener(d,E)}(g||e)&&(Ze(n,d,e,g),g&&Xe([d]))}else if(t.slice(0,5)==="attr:")R(n,t.slice(5),e);else if((h=t.slice(0,5)==="prop:")||(c=Re.has(t))||!i&&((f=_e(t,n.tagName))||(o=$e.has(t)))||(r=n.nodeName.includes("-")))h&&(t=t.slice(5),o=!0),t==="class"||t==="className"?ze(n,e):r&&!o&&!c?n[it(t)]=e:n[f||t]=e;else{const d=i&&t.indexOf(":")>-1&&Ge[t.split(":")[0]];d?Ye(n,d,t,e):R(n,Ue[t]||t,e)}return e}function st(n){const t=`$$${n.type}`;let e=n.composedPath&&n.composedPath()[0]||n.target;for(n.target!==e&&Object.defineProperty(n,"target",{configurable:!0,value:e}),Object.defineProperty(n,"currentTarget",{configurable:!0,get(){return e||document}}),m.registry&&!m.done&&(m.done=_$HY.done=!0);e;){const s=e[t];if(s&&!e.disabled){const i=e[`${t}Data`];if(i!==void 0?s.call(e,i,n):s.call(e,n),n.cancelBubble)return}e=e._$host||e.parentNode||e.host}}function P(n,t,e,s,i){if(m.context){!e&&(e=[...n.childNodes]);let o=[];for(let c=0;c<e.length;c++){const f=e[c];f.nodeType===8&&f.data.slice(0,2)==="!$"?f.remove():o.push(f)}e=o}for(;typeof e=="function";)e=e();if(t===e)return e;const l=typeof t,r=s!==void 0;if(n=r&&e[0]&&e[0].parentNode||n,l==="string"||l==="number"){if(m.context)return e;if(l==="number"&&(t=t.toString()),r){let o=e[0];o&&o.nodeType===3?o.data=t:o=document.createTextNode(t),e=S(n,e,s,o)}else e!==""&&typeof e=="string"?e=n.firstChild.data=t:e=n.textContent=t}else if(t==null||l==="boolean"){if(m.context)return e;e=S(n,e,s)}else{if(l==="function")return A(()=>{let o=t();for(;typeof o=="function";)o=o();e=P(n,o,e,s)}),()=>e;if(Array.isArray(t)){const o=[],c=e&&Array.isArray(e);if(W(o,t,e,i))return A(()=>e=P(n,o,e,s,!0)),()=>e;if(m.context){if(!o.length)return e;for(let f=0;f<o.length;f++)if(o[f].parentNode)return e=o}if(o.length===0){if(e=S(n,e,s),r)return e}else c?e.length===0?ie(n,o,s):qe(n,e,o):(e&&S(n),ie(n,o));e=o}else if(t.nodeType){if(m.context&&t.parentNode)return e=r?[t]:t;if(Array.isArray(e)){if(r)return e=S(n,e,s,t);S(n,e,null,t)}else e==null||e===""||!n.firstChild?n.appendChild(t):n.replaceChild(t,n.firstChild);e=t}}return e}function W(n,t,e,s){let i=!1;for(let l=0,r=t.length;l<r;l++){let o=t[l],c=e&&e[l],f;if(!(o==null||o===!0||o===!1))if((f=typeof o)=="object"&&o.nodeType)n.push(o);else if(Array.isArray(o))i=W(n,o,c)||i;else if(f==="function")if(s){for(;typeof o=="function";)o=o();i=W(n,Array.isArray(o)?o:[o],Array.isArray(c)?c:[c])||i}else n.push(o),i=!0;else{const h=String(o);c&&c.nodeType===3&&c.data===h?n.push(c):n.push(document.createTextNode(h))}}return i}function ie(n,t,e=null){for(let s=0,i=t.length;s<i;s++)n.insertBefore(t[s],e)}function S(n,t,e,s){if(e===void 0)return n.textContent="";const i=s||document.createTextNode("");if(t.length){let l=!1;for(let r=t.length-1;r>=0;r--){const o=t[r];if(i!==o){const c=o.parentNode===n;!l&&!r?c?n.replaceChild(i,o):n.insertBefore(i,e):c&&o.remove()}else l=!0}}else n.insertBefore(i,e);return[i]}function ot(){const n=m.context;return`${n.id}${n.count++}`}const lt="http://www.w3.org/2000/svg";function re(n,t=!1){return t?document.createElementNS(lt,n):document.createElement(n)}function Et(n){const{useShadow:t}=n,e=document.createTextNode(""),s=()=>n.mount||document.body,i=Q();let l,r=!!m.context;return Se(()=>{r&&(Q().user=r=!1),l||(l=Ae(i,()=>$(()=>n.children)));const o=s();if(o instanceof HTMLHeadElement){const[c,f]=xe(!1),h=()=>f(!0);se(d=>U(o,()=>c()?d():l(),null)),Z(h)}else{const c=re(n.isSVG?"g":"div",n.isSVG),f=t&&c.attachShadow?c.attachShadow({mode:"open"}):c;Object.defineProperty(c,"_$host",{get(){return e.parentNode},configurable:!0}),U(f,l),o.appendChild(c),n.ref&&n.ref(c),Z(()=>o.removeChild(c))}},void 0,{render:!r}),e}function vt(n){const[t,e]=Pe(n,["component"]),s=$(()=>t.component);return $(()=>{const i=s();switch(typeof i){case"function":return _(()=>i(e));case"string":const l=je.has(i),r=m.context?nt():re(i,l);return et(r,e,l),r}})}const K=document.body;let x=K;const ae=()=>{x=le()||K,F.reAppend()};He(K,ae);const b=class b extends Oe{constructor(t,e={}){if(super(!1),this.element=document.createElement("div"),this.container=document.createElement("div"),this.header=document.createElement("div"),this.title=document.createElement("div"),this.element.classList.add("popup"),this.element.className="popup"+(t?" "+t:""),this.container.classList.add("popup-container","z-depth-1"),H.isDarkOverlayActive&&(this.night=!0,this.element.classList.add("night")),this.header.classList.add("popup-header"),e.title&&(this.title.classList.add("popup-title"),typeof e.title=="string"?oe(this.title,e.title):typeof e.title!="boolean"&&this.title.append(e.title),this.header.append(this.title)),this.isConfirmationNeededOnClose=e.isConfirmationNeededOnClose,this.middlewareHelper=Ce(),this.listenerSetter=new be,this.managers=b.MANAGERS,this.confirmShortcutIsSendShortcut=e.confirmShortcutIsSendShortcut,e.closable&&(this.btnClose=pe("",{noRipple:!0}),this.btnClose.classList.add("popup-close"),this.header.prepend(this.btnClose),e.onBackClick?(this.btnCloseAnimatedIcon=document.createElement("div"),this.btnCloseAnimatedIcon.classList.add("animated-close-icon"),this.btnClose.append(this.btnCloseAnimatedIcon)):this.btnClose.append(X("close")),N(this.btnClose,()=>{e.onBackClick&&this.btnCloseAnimatedIcon.classList.contains("state-back")?e.onBackClick()!==!1&&this.btnCloseAnimatedIcon.classList.remove("state-back"):this.hide()},{listenerSetter:this.listenerSetter})),this.withoutOverlay=e.withoutOverlay,this.withoutOverlay&&this.element.classList.add("no-overlay"),e.overlayClosable&&N(this.element,s=>{ke(s.target,"popup-container")||!s.target.isConnected||this.hide()},{listenerSetter:this.listenerSetter}),e.withConfirm&&(this.btnConfirm=document.createElement("button"),this.btnConfirm.classList.add("btn-primary","btn-color-primary"),e.withConfirm!==!0&&this.btnConfirm.append(J(e.withConfirm)),this.header.append(this.btnConfirm)),this.container.append(this.header),e.body&&(this.body=document.createElement("div"),this.body.classList.add("popup-body"),this.container.append(this.body)),e.scrollable){const s=this.scrollable=new Me(this.body);if(this.attachScrollableListeners(),e.floatingHeader){this.attachScrollableListeners(this.header);const i=document.createElement("div");i.classList.add("popup-header-background"),this.header.prepend(i),this.header.classList.add("is-floating")}this.body||this.header.after(s.container)}e.footer&&(this.footer=document.createElement("div"),this.footer.classList.add("popup-footer"),(this.body||this.container).append(this.footer)),this.btnConfirmOnEnter=this.btnConfirm,this.setButtons(e.buttons),this.element.append(this.container),b.POPUPS.push(this)}setButtons(t){if(this.buttons=t,this.buttonsEl&&(this.buttonsEl.remove(),this.buttonsEl=void 0),!t?.length)return;const e=this.buttonsEl=document.createElement("div");e.classList.add("popup-buttons");const s=t.map(i=>{const l=document.createElement("button");if(l.className="popup-button btn"+(i.isDanger?" danger":" primary"),i.noRipple||ye(l),i.text?l.append(i.text):i.langKey&&l.append(J(i.langKey,i.langArgs)),i.iconLeft||i.iconRight){const r=X(i.iconLeft||i.iconRight,"popup-button-icon",i.iconLeft?"left":"right");l.classList.add("with-icon"),i.iconLeft?l.prepend(r):l.append(r)}return N(l,async r=>{let o=i.callback?.(r);if(o!==void 0&&o instanceof Promise){const c=Ee([i.element],!0);try{o=await o}catch{o=!1}o===!1&&c()}o!==!1&&this.hide()},{listenerSetter:this.listenerSetter}),i.element=l});if(!this.btnConfirmOnEnter&&t.length===2){const i=t.find(l=>!l.isCancel);i&&(this.btnConfirmOnEnter=i.element)}t.length>=3&&e.classList.add("is-vertical-layout"),e.append(...s),this.container.append(e)}attachScrollableListeners(t){return this.scrollable.attachBorderListeners(t)}onContentUpdate(){this.scrollable?.onAdditionalScroll?.()}show(){this.navigationItem={type:"popup",onPop:()=>{if(this.isConfirmationNeededOnClose){const t=this.isConfirmationNeededOnClose();if(t)return Promise.resolve(t).then(()=>{this.destroy()}),!1}return this.destroy()}},B.pushItem(this.navigationItem),Te(),x.append(this.element),this.element.offsetWidth,this.element.classList.add("active"),this.onContentUpdate(),this.withoutOverlay||(H.isOverlayActive=!0,Y.checkAnimations2(!0)),setTimeout(()=>{this.element.classList.contains("active")&&this.listenerSetter.add(document.body)("keydown",t=>{!this.btnConfirmOnEnter||this.btnConfirmOnEnter.disabled||b.POPUPS[b.POPUPS.length-1]!==this||(this.confirmShortcutIsSendShortcut?De(t):t.key==="Enter")&&(Ie(this.btnConfirmOnEnter),Ne(t))})},0)}hide(){this.destroyed||!this.navigationItem||B.backByItem(this.navigationItem)}hideWithCallback(t){this.addEventListener("closeAfterTimeout",t),this.hide()}forceHide(){return this.destroy()}destroy(){this.destroyed||(this.destroyed=!0,this.dispatchEvent("close"),this.element.classList.add("hiding"),this.element.classList.remove("active"),this.listenerSetter.removeAll(),this.middlewareHelper.destroy(),this.withoutOverlay||(H.isOverlayActive=!1),B.removeItem(this.navigationItem),this.navigationItem=void 0,Fe(b.POPUPS,this),ae(),setTimeout(()=>{this.element.remove(),this.dispatchEvent("closeAfterTimeout"),this.cleanup(),this.scrollable?.destroy(),this.withoutOverlay||Y.checkAnimations2(!1)},250))}appendSolid(t){const e=document.createElement("div");(this.scrollable||this.body).append(e);const s=Ve(t,e);this.addEventListener("closeAfterTimeout",s)}static reAppend(){this.POPUPS.forEach(t=>{const{element:e,container:s}=t,i=e.parentElement;i&&i!==x&&x!==s&&x.append(e)})}static getPopups(t){return this.POPUPS.filter(e=>e instanceof t)}static createPopup(t,...e){return new t(...e)}};b.POPUPS=[];let F=b;const Lt=n=>(n.find(e=>e.isCancel)||n.push({langKey:"Cancel",isCancel:!0}),n);function rt(n,t){let e,s,i,l=0,r=0,o=0,c=0,f=0;const h=4,d={},g=50,E=200,O=200;n.complete?j():n.onload=j;function ce(){s.removeEventListener("mousedown",k),s.removeEventListener("touchstart",k),s.removeEventListener("wheel",V),document.removeEventListener("mouseup",v),document.removeEventListener("touchend",v),document.removeEventListener("mousemove",L),document.removeEventListener("touchmove",L),document.removeEventListener("keypress",q),e.remove(),s.remove(),i.remove()}function de(){s.addEventListener("mousedown",k,!1),s.addEventListener("touchstart",k,!1),s.addEventListener("wheel",V,!1),document.addEventListener("keypress",q,!1)}function j(){n.classList.add("crop-blur"),n.draggable=!1,i=new Image,i.src=n.src,i.draggable=!1,i.classList.add("crop-overlay-image"),t||(t=document.createElement("canvas")),e=document.createElement("div"),e.classList.add("crop-component"),s=document.createElement("div"),s.classList.add("crop-overlay");const a=document.createElement("div");a.classList.add("crop-overlay-color"),e.appendChild(s),n.parentNode.appendChild(e),e.appendChild(i),e.appendChild(n),e.appendChild(a),s.appendChild(i),i.style.maxWidth=n.width+"px",f=n.naturalWidth/n.offsetWidth;const y=n.offsetWidth/2-E/2,p=n.offsetHeight/2-O/2;G(E,O),I(y,p),M(y,p),de()}function G(a,u){o=a*f,c=u*f,s.style.width=a+"px",s.style.height=u+"px"}function I(a,u){r=u*f,l=a*f,i.style.top=-u+"px",i.style.left=-a+"px"}function M(a,u){s.style.top=u+"px",s.style.left=a+"px"}function fe(a){d.container_width=s.offsetWidth,d.container_height=s.offsetHeight,d.container_left=s.offsetLeft,d.container_top=s.offsetTop,d.mouse_x=(a.clientX||a.pageX||a.touches&&a.touches[0].clientX)+window.scrollX,d.mouse_y=(a.clientY||a.pageY||a.touches&&a.touches[0].clientY)+window.scrollY}function D(a){a=a*Math.PI*2;const u=Math.floor(s.clientWidth+a),y=Math.floor(s.clientHeight+a),p=i.clientWidth,T=i.clientHeight;let C,w;if(u<g)return;if(u>p)return;C=s.offsetLeft-a/2,w=s.offsetTop-a/2;const ue=C+u,me=w+y;C<0&&(C=0),w<0&&(w=0),!(ue>p)&&(me>T||(G(u,u),I(C,w),M(C,w)))}function q(a){switch(a.preventDefault(),String.fromCharCode(a.charCode)){case"+":D(h);break;case"-":D(-h);break}}function V(a){a.preventDefault(),D(a.deltaY>0?1:-1)}function k(a){a.preventDefault(),a.stopPropagation(),fe(a),document.addEventListener("mousemove",L),document.addEventListener("touchmove",L),document.addEventListener("mouseup",v),document.addEventListener("touchend",v)}function v(a){a.preventDefault(),document.removeEventListener("mouseup",v),document.removeEventListener("touchend",v),document.removeEventListener("mousemove",L),document.removeEventListener("touchmove",L)}function L(a){const u={x:0,y:0};a.preventDefault(),a.stopPropagation(),u.x=a.pageX||a.touches&&a.touches[0].pageX,u.y=a.pageY||a.touches&&a.touches[0].pageY;let y=u.x-(d.mouse_x-d.container_left),p=u.y-(d.mouse_y-d.container_top);const T=s.offsetWidth,C=s.offsetHeight;y<0?y=0:y>i.offsetWidth-T&&(y=i.offsetWidth-T),p<0?p=0:p>i.offsetHeight-C&&(p=i.offsetHeight-C),I(y,p),M(y,p)}function he(){t.width=o,t.height=c,t.getContext("2d").drawImage(n,l,r,o,c,0,0,o,c)}return{crop:he,removeHandlers:ce}}function at(n,t){return new Promise(e=>{const s=new FileReader;s.addEventListener("loadend",i=>{e(i.target.result)}),s[t](n)})}function ct(n){return at(n,"readAsDataURL")}class wt extends F{constructor(t={}){super("popup-avatar",{closable:!0}),this.image=new Image,this.cropper={crop:()=>{},removeHandlers:()=>{}},this.h6=document.createElement("h6"),oe(this.h6,"Popup.Avatar.Title"),this.btnClose.classList.remove("btn-icon"),this.header.append(this.h6),this.cropContainer=document.createElement("div"),this.cropContainer.classList.add("crop"),this.cropContainer.append(this.image),t.isForum&&this.cropContainer.classList.add("is-forum"),this.input=document.createElement("input"),this.input.type="file",this.input.style.display="none",this.listenerSetter.add(this.input)("change",e=>{const s=e.target.files[0];s&&ct(s).then(i=>{this.image=new Image,this.cropContainer.append(this.image),this.image.src=i,this.image.onload=()=>{this.show(),this.cropper=rt(this.image,this.canvas),this.input.value=""}})},!1),this.btnConfirm=ge("btn-primary btn-color-primary btn-circle btn-crop btn-icon z-depth-1",{noRipple:!0,icon:"check"}),N(this.btnConfirm,()=>{this.cropper.crop(),this.hide(),this.canvas.toBlob(e=>{this.blob=e,this.darkenCanvas(),this.resolve()},"image/jpeg",1)},{listenerSetter:this.listenerSetter}),this.container.append(this.cropContainer,this.btnConfirm,this.input),this.addEventListener("closeAfterTimeout",()=>{this.cropper.removeHandlers(),this.image&&this.image.remove()})}resolve(){this.onCrop(()=>ve.upload(this.blob))}open(t,e){this.canvas=t,this.onCrop=e,this.input.click()}darkenCanvas(){const t=this.canvas.getContext("2d");t.fillStyle="rgba(0, 0, 0, 0.3)",t.fillRect(0,0,this.canvas.width,this.canvas.height)}}export{vt as D,F as P,wt as a,Qe as b,ze as c,et as d,Lt as e,He as f,le as g,gt as h,U as i,yt as j,Xe as k,Ve as l,Et as m,Je as n,Ze as o,ct as p,De as q,pt as r,R as s,Ct as t,bt as u};
//# sourceMappingURL=avatar-BjEbBb6X.js.map

const __vite__fileDeps=["./pageIm-Dz55Dpoz.js","./index-CvWBhmNo.js","./index-CPYeyI0a.css","./page-9xzdIDLN.js","./pageAuthCode-DRFBn4cK.js","./codeInputField-sWPN9Xm0.js","./wrapEmojiText-C9ZwzJ29.js","./buttonIcon-Beq2DGJD.js","./putPreloader-XqhBclwv.js","./countryInputField-D8kEeBe8.js","./scrollable-COTa0yl_.js","./pageSignQR-99Bv1MS4.js","./textToSvgURL-Cnw_Q8Rw.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{a as c,b as r,c as E,d as S,i as y,A as C,_ as x,e as P,I as N,f as F,g as B,h as D}from"./index-CvWBhmNo.js";import{p as O}from"./putPreloader-XqhBclwv.js";import{P as V,a as U}from"./page-9xzdIDLN.js";import{C as W,T as q,a as z}from"./countryInputField-D8kEeBe8.js";import{B as H,a as w,r as K}from"./buttonIcon-Beq2DGJD.js";import{p as Q,l as $,t as j,r as f}from"./wrapEmojiText-C9ZwzJ29.js";import{p as R,g as G}from"./pageSignQR-99Bv1MS4.js";import"./scrollable-COTa0yl_.js";import"./textToSvgURL-Cnw_Q8Rw.js";let a=null,d;const J=()=>{if(r.getLoggedInInstanceIDs().length>0){const e=document.createElement("div"),t=H("close");t.addEventListener("click",async()=>{let i=r.getLoggedInInstanceIDs().find(u=>u==r.getLastInstanceId());i||(i=r.getLoggedInInstanceIDs()[0]),await r.destroyInstance(r.getActiveInstanceID()),await r.switchToInstance(i)}),e.append(t),T.pageEl.querySelector(".auth-image").parentElement.prepend(e)}const h=document.createElement("div");h.classList.add("input-wrapper");let _,L;const g=new W({onCountryChange:(e,t)=>{_=e,L=t,t&&(s.value=s.lastValue="+"+t.country_code,setTimeout(()=>{p.focus(),Q(p,!0)},0))}}),s=new q({onInput:e=>{$.loadLottieWorkers();const{country:t,code:o}=e||{},n=t?t.name||t.default_name:"";n!==g.value&&(!_||!t||!o||_!==t&&L.country_code!==o.country_code)&&g.override(t,o,n),t||s.value.length-1>1?a.style.visibility="":a.style.visibility="hidden"}}),p=s.input;p.addEventListener("keypress",e=>{if(!a.style.visibility&&e.key==="Enter")return k()});const l=new z({text:"Login.KeepSigned",name:"keepSession",withRipple:!0,checked:!0});l.input.addEventListener("change",()=>{const e=l.checked;c.managers.appStateManager.pushToState("keepSigned",e),E.toggleStorages(e,!0)}),E.getState().then(e=>{S.isAvailable()?l.checked=e.keepSigned:(l.checked=!1,l.label.classList.add("checkbox-disabled"))}),a=w("btn-primary btn-color-primary",{text:"Login.Next"}),a.style.visibility="hidden";const k=e=>{e&&F(e);const t=j([a,d],!0);f(a,y("PleaseWait")),O(a);const o=s.value;c.managers.apiManager.invokeApi("auth.sendCode",{phone_number:o,api_id:C.id,api_hash:C.hash,settings:{_:"codeSettings",pFlags:{}}}).then(async n=>{if(n._==="auth.sentCodeSuccess"){const{authorization:i}=n;i._==="auth.authorization"&&(await c.managers.apiManager.setUser(i.user),x(()=>import("./pageIm-Dz55Dpoz.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(u=>{u.default.mount()}))}x(()=>import("./pageAuthCode-DRFBn4cK.js"),__vite__mapDeps([4,1,2,3,5,6,7,8,9,10,11,12]),import.meta.url).then(i=>i.default.mount(Object.assign(n,{phone_number:o})))}).catch(n=>{switch(t(),n.type){case"PHONE_NUMBER_INVALID":s.setError(),f(s.label,y("Login.PhoneLabelInvalid")),p.classList.add("error"),f(a,y("Login.Next"));break;default:console.error("auth.sendCode error:",n),a.innerText=n.type;break}})};U(a,k),d=w("btn-primary btn-secondary btn-primary-transparent primary",{text:"Login.QR.Login"}),d.addEventListener("click",()=>{R.mount()}),h.append(g.container,s.container,l.label,a,d);const v=document.createElement("h4");v.classList.add("text-center"),P(v,"Login.Title");const b=document.createElement("div");b.classList.add("subtitle","text-center"),P(b,"Login.StartText"),T.pageEl.querySelector(".container").append(v,b,h);const A=()=>{c.managers.apiManager.invokeApi("help.getNearestDc").then(e=>{const t=S.getFromCache("langPack");t&&!t.countries?.hash&&B.getLangPack(t.lang_code).then(()=>{s.simulateInputEvent()});const o=new Set([1,2,3,4,5]),n=[e.this_dc];let i;return e.nearest_dc!==e.this_dc&&(i=c.managers.apiManager.getNetworkerVoid(e.nearest_dc).then(()=>{n.push(e.nearest_dc)})),(i||Promise.resolve()).then(()=>{n.forEach(m=>{o.delete(m)});const u=[...o],I=async()=>{const m=u.shift();if(!m)return;const M=`dc${m}_auth_key`;if(await D.get(M))return I();setTimeout(()=>{c.managers.apiManager.getNetworkerVoid(m).finally(I)},3e3)};I()}),e}).then(e=>{!g.value.length&&!s.value.length&&g.selectCountryByIso2(e.country)})};N||setTimeout(()=>{p.focus()},0),G(h),A()},T=new V("page-sign",!0,J,()=>{a&&(f(a,y("Login.Next")),K(a,void 0,void 0,!0),a.removeAttribute("disabled")),d&&d.removeAttribute("disabled"),c.managers.appStateManager.pushToState("authState",{_:"authStateSignIn"})});export{T as default};
//# sourceMappingURL=pageSignIn-CCvqSK4z.js.map

class g{static enhance(t,n,a,c){const h=1+.1*c;t=this.brightness(t,h);const r=10*c;t=this.contrast(t,r);const o=1+.2*c;t=this.saturation(t,o);const e=.1*c;return t=this.vignette(t,n,a,e),t}static brightness(t,n){for(let a=0;a<t.length;a+=4)t[a]=Math.min(t[a]*n,255)|0,t[a+1]=Math.min(t[a+1]*n,255)|0,t[a+2]=Math.min(t[a+2]*n,255)|0;return t}static contrast(t,n){const a=259*(n+255)/(255*(259-n));for(let c=0;c<t.length;c+=4)t[c]=Math.min(Math.max(a*(t[c]-128)+128,0),255)|0,t[c+1]=Math.min(Math.max(a*(t[c+1]-128)+128,0),255)|0,t[c+2]=Math.min(Math.max(a*(t[c+2]-128)+128,0),255)|0;return t}static saturation(t,n){for(let r=0;r<t.length;r+=4){const o=.2989*t[r]+.587*t[r+1]+.114*t[r+2]|0;t[r]=Math.min(Math.max(o+n*(t[r]-o),0),255)|0,t[r+1]=Math.min(Math.max(o+n*(t[r+1]-o),0),255)|0,t[r+2]=Math.min(Math.max(o+n*(t[r+2]-o),0),255)|0}return t}static warmth(t,n){for(let a=0;a<t.length;a+=4)t[a]=Math.min(t[a]+n,255)|0,t[a+2]=Math.max(t[a+2]-n,0)|0;return t}static fade(t,n){for(let a=0;a<t.length;a+=4){const c=t[a],h=t[a+1],r=t[a+2],o=.2989*c+.587*h+.114*r;t[a]=Math.min(Math.max((1-n)*c+n*o,0),255)|0,t[a+1]=Math.min(Math.max((1-n)*h+n*o,0),255)|0,t[a+2]=Math.min(Math.max((1-n)*r+n*o,0),255)|0}return t}static highlights(t,n){for(let a=0;a<t.length;a+=4){const c=t[a],h=t[a+1],r=t[a+2];.299*c+.587*h+.114*r>128&&(t[a]=Math.min(Math.max(c+n*(255-c),0),255)|0,t[a+1]=Math.min(Math.max(h+n*(255-h),0),255)|0,t[a+2]=Math.min(Math.max(r+n*(255-r),0),255)|0)}return t}static shadows(t,n){n=Math.max(-1,Math.min(1,n));for(let a=0;a<t.length;a+=4){const c=t[a],h=t[a+1],r=t[a+2];.299*c+.587*h+.114*r<128&&(t[a]=Math.min(Math.max(c+n*c,0),255)|0,t[a+1]=Math.min(Math.max(h+n*h,0),255)|0,t[a+2]=Math.min(Math.max(r+n*r,0),255)|0)}return t}static vignette(t,n,a,c){const h=n/2,r=a/2,o=Math.sqrt(h*h+r*r);for(let e=0;e<a;e++)for(let s=0;s<n;s++){const m=(e*n+s)*4,f=t[m],b=t[m+1],k=t[m+2],R=Math.sqrt((s-h)*(s-h)+(e-r)*(e-r)),i=1-Math.min(R/o*c,1);t[m]=Math.min(Math.max(f*i,0),255)|0,t[m+1]=Math.min(Math.max(b*i,0),255)|0,t[m+2]=Math.min(Math.max(k*i,0),255)|0}return t}static grain(t,n,a,c){for(let h=0;h<a;h++)for(let r=0;r<n;r++){const o=(h*n+r)*4,e=t[o],s=t[o+1],m=t[o+2],f=(Math.random()-.5)*255*c;t[o]=Math.min(Math.max(e+f,0),255)|0,t[o+1]=Math.min(Math.max(s+f,0),255)|0,t[o+2]=Math.min(Math.max(m+f,0),255)|0}return t}static sharpen(t,n,a,c){const h=new Uint8ClampedArray(t);function r(o,e,s=0){return o<0||o>=n||e<0||e>=a?0:h[(e*n+o)*4+s]}for(let o=0;o<a;o++)for(let e=0;e<n;e++){const s=(o*n+e)*4,m=-r(e-1,o,0)+-r(e,o-1,0)+5*r(e,o,0)+-r(e,o+1,0)+-r(e+1,o,0),f=-r(e-1,o,1)+-r(e,o-1,1)+5*r(e,o,1)+-r(e,o+1,1)+-r(e+1,o,1),b=-r(e-1,o,2)+-r(e,o-1,2)+5*r(e,o,2)+-r(e,o+1,2)+-r(e+1,o,2);t[s]=Math.min(Math.max((1-c)*r(e,o,0)+c*m,0),255)|0,t[s+1]=Math.min(Math.max((1-c)*r(e,o,1)+c*f,0),255)|0,t[s+2]=Math.min(Math.max((1-c)*r(e,o,2)+c*b,0),255)|0}return t}}class D{static flip(t,n,a){const c=new Uint8ClampedArray(t.length);for(let h=0;h<a;h++)for(let r=0;r<n;r++)for(let o=0;o<4;o++)c[(h*n+r)*4+o]=t[(h*n+(n-r-1))*4+o];return c}static rotate(t,n,a,c){const h=n*Math.PI/180,r=Math.sin(h),o=Math.cos(h),e=Math.abs(Math.ceil(a*o+c*r)),s=Math.abs(Math.ceil(a*r+c*o)),m=new Uint8ClampedArray(e*s*4),f=a/2,b=c/2,k=e/2,R=s/2;for(let i=0;i<s;i++)for(let u=0;u<e;u++){const w=Math.cos(h)*(u-k)-Math.sin(h)*(i-R)+f,C=Math.sin(h)*(u-k)+Math.cos(h)*(i-R)+b,O=Math.floor(w),v=Math.floor(C);if(O>=0&&O<a&&v>=0&&v<c)for(let y=0;y<4;y++)m[(i*e+u)*4+y]=t[(v*a+O)*4+y]}return{pixels:m,width:e,height:s}}}class M{static actionFilter(t,n,a,c){switch(n.type){case"enhance":t=g.enhance(t,a,c,M.clampWithRatio(n.amount,0,100,0,1));break;case"brightness":t=g.brightness(t,M.clampWithRatio(n.amount,-100,100,.25,1.75));break;case"contrast":t=g.contrast(t,M.clampWithRatio(n.amount,-100,100,-192,192));break;case"saturation":t=g.saturation(t,M.clampWithRatio(n.amount,-100,100,.25,1.75));break;case"warmth":t=g.warmth(t,M.clampWithRatio(n.amount,-100,100,-100,100));break;case"fade":t=g.fade(t,M.clampWithRatio(n.amount,0,100,0,.75));break;case"highlights":t=g.highlights(t,M.clampWithRatio(n.amount,-100,100,-.125,.125));break;case"shadows":t=g.shadows(t,M.clampWithRatio(n.amount,-100,100,-.125,.125));break;case"vignette":t=g.vignette(t,a,c,M.clampWithRatio(n.amount,0,100,0,1));break;case"grain":t=g.grain(t,a,c,M.clampWithRatio(n.amount,0,100,0,.25));break;case"sharpen":t=g.sharpen(t,a,c,M.clampWithRatio(n.amount,0,100,0,.75));break}return t}static actionCrop(t,n,a,c){switch(n.type){case"flip":t=D.flip(t,a,c);break;case"rotate":const h=D.rotate(t,n.degree,a,c);t=h.pixels,a=h.width,c=h.height;break}return{pixels:t,width:a,height:c}}static clampWithRatio(t,n,a,c,h){const o=(Math.max(n,Math.min(t,a))-n)/(a-n);return c+o*(h-c)}}const W={actions:["","filter","crop","sticker","text","paint"],sticker:["static"],text:["default"],paint:["default"],crop:["flip","rotate"],filter:["enhance","brightness","contrast","saturation","warmth","shadows","highlights","sharpen","grain","fade","vignette"]};onmessage=d=>{const{type:t,data:n,instance:a}=d.data;switch(t){case"render":let c=n.imageData.data,h=n.imageData.width,r=n.imageData.height;const o=n.actions.sort((s,m)=>{const f=parseInt(`${W.actions.indexOf(s.action)}${W[s.action].indexOf(s.type).toString().padStart(2,"0")}`),b=parseInt(`${W.actions.indexOf(m.action)}${W[m.action].indexOf(m.type).toString().padStart(2,"0")}`);if(f&&b)return f-b});for(const s of o)switch(s.action){case"filter":c=M.actionFilter(c,s,h,r);break;case"crop":const m=M.actionCrop(c,s,h,r);c=m.pixels,h=m.width,r=m.height;break}const e=new ImageData(c,h,r,{colorSpace:n.imageData.colorSpace});postMessage({type:"render",instance:a,data:e});break}};
//# sourceMappingURL=mediaEditor.worker-ncuEHBdZ.js.map

const __vite__fileDeps=["./pageSignIn-CCvqSK4z.js","./index-CvWBhmNo.js","./index-CPYeyI0a.css","./putPreloader-XqhBclwv.js","./page-9xzdIDLN.js","./countryInputField-D8kEeBe8.js","./buttonIcon-Beq2DGJD.js","./wrapEmojiText-C9ZwzJ29.js","./scrollable-COTa0yl_.js","./textToSvgURL-Cnw_Q8Rw.js","./qr-code-styling-CvBVNv73.js","./_commonjsHelpers-Cpj98o6Y.js","./pageIm-Dz55Dpoz.js","./pagePassword-BUHj7bf5.js","./htmlToSpan-Cs_vmNib.js","./loginPage-CxZlI-GA.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{g as p,l as V,a as u,f as $,b as m,e as F,i as z,_ as L,A as P,p as C}from"./index-CvWBhmNo.js";import{a as R,B as H}from"./buttonIcon-Beq2DGJD.js";import{a as N,P as j}from"./page-9xzdIDLN.js";import{b as W,t as G}from"./textToSvgURL-Cnw_Q8Rw.js";import{p as A}from"./putPreloader-XqhBclwv.js";function J(e){let a,d="";for(let l=e.length,o=0,n=0;n<l;++n)a=n%3,o|=e[n]<<(16>>>a&24),(a===2||l-n===1)&&(d+=String.fromCharCode(E(o>>>18&63),E(o>>>12&63),E(o>>>6&63),E(o&63)),o=0);return d.replace(/A(?=A$|$)/g,"=")}function E(e){return e<26?e+65:e<52?e+71:e<62?e-4:e===62?43:e===63?47:65}function K(e,a){return e.replace(/\+/g,"-").replace(/\//g,"_").replace(/\=+$/,"")}let T=!1;function X(){return S||(S=u.managers.apiManager.getConfig().then(e=>e.suggested_lang_code!==p.lastRequestedLangCode?Promise.all([e,p.getStrings(e.suggested_lang_code,["Login.ContinueOnLanguage"]),p.getCacheLangPack()]):[]))}let S;function Y(e){T||X().then(([a,d])=>{if(!a)return;const l=[];d.forEach(i=>{const f=p.strings.get(i.key);f&&(l.push(f),p.strings.set(i.key,i))});const o="Login.ContinueOnLanguage",n=R("btn-primary btn-secondary btn-primary-transparent primary",{text:o});n.lastElementChild.classList.remove("i18n"),V({text:[p.format(o,!0)]}).then(()=>{window.requestAnimationFrame(()=>{e.append(n)})}),u.addEventListener("language_change",()=>{n.remove()},{once:!0}),l.forEach(i=>{p.strings.set(i.key,i)}),N(n,i=>{$(i),T=!0,n.disabled=!0,A(n),p.getLangPack(a.suggested_lang_code)})})}const b=3,Z=async()=>{const a=O.pageEl.querySelector(".auth-image");let d=A(a,!0);if(m.getLoggedInInstanceIDs().length>0){const s=document.createElement("div"),t=H("close");t.addEventListener("click",async()=>{let c=m.getLoggedInInstanceIDs().find(g=>g==m.getLastInstanceId());c||(c=m.getLoggedInInstanceIDs()[0]),await m.destroyInstance(m.getActiveInstanceID()),await m.switchToInstance(c)}),s.append(t),a.parentElement.prepend(s)}const l=document.createElement("div");l.classList.add("input-wrapper");const o=R("btn-primary btn-secondary btn-primary-transparent primary",{text:"Login.QR.Cancel"});l.append(o),Y(l);const n=a.parentElement,i=document.createElement("h4");F(i,"Login.QR.Title");const f=document.createElement("ol");f.classList.add("qr-description"),["Login.QR.Help1","Login.QR.Help2","Login.QR.Help3"].forEach(s=>{const t=document.createElement("li");t.append(z(s)),f.append(t)}),n.append(i,f,l),o.addEventListener("click",()=>{L(()=>import("./pageSignIn-CCvqSK4z.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]),import.meta.url).then(s=>s.default.mount()),h=!0});const x=(await Promise.all([L(()=>import("./qr-code-styling-CvBVNv73.js").then(s=>s.q),__vite__mapDeps([10,11]),import.meta.url)]))[0].default;let h=!1;u.addEventListener("user_auth",()=>{h=!0,_=null},{once:!0});const w={ignoreErrors:!0};let k;const D=async s=>{try{let t=await u.managers.apiManager.invokeApi("auth.exportLoginToken",{api_id:P.id,api_hash:P.hash,except_ids:[]},{ignoreErrors:!0});if(t._==="auth.loginTokenMigrateTo"&&(w.dcId||(w.dcId=t.dc_id,u.managers.apiManager.setBaseDcId(t.dc_id)),t=await u.managers.apiManager.invokeApi("auth.importLoginToken",{token:t.token},w)),t._==="auth.loginTokenSuccess"){const c=t.authorization;return await u.managers.apiManager.setUser(c.user),L(()=>import("./pageIm-Dz55Dpoz.js"),__vite__mapDeps([12,1,2,4]),import.meta.url).then(g=>g.default.mount()),!0}if(!k||!W(k,t.token)){k=t.token;const c=J(t.token),g="tg://login?token="+K(c,!0),v=window.getComputedStyle(document.documentElement),B=v.getPropertyValue("--surface-color").trim(),M=v.getPropertyValue("--primary-text-color").trim(),q=v.getPropertyValue("--primary-color").trim(),Q=await fetch("assets/img/logo_padded.svg").then(r=>r.text()).then(r=>(r=r.replace(/(fill:).+?(;)/,`$1${q}$2`),G(r))),y=new x({width:240*window.devicePixelRatio,height:240*window.devicePixelRatio,data:g,image:Q,dotsOptions:{color:M,type:"rounded"},cornersSquareOptions:{type:"extra-rounded"},imageOptions:{imageSize:1,margin:0},backgroundOptions:{color:B},qrOptions:{errorCorrectionLevel:"L"}});y.append(a),a.lastChild.classList.add("qr-canvas");let I;y._drawingPromise?I=y._drawingPromise:I=Promise.race([C(1e3),new Promise(r=>{y._canvas._image.addEventListener("load",()=>{window.requestAnimationFrame(()=>r())},{once:!0})})]),await I.then(()=>{if(d){d.style.animation="hide-icon .4s forwards";const r=a.children[1];r.style.display="none",r.style.animation="grow-icon .4s forwards",setTimeout(()=>{r.style.display=""},150),setTimeout(()=>{r.style.animation=""},500),d=void 0}else Array.from(a.children).slice(0,-1).forEach(r=>{r.remove()})})}if(s){const c=Date.now()/1e3,g=t.expires-c-await u.managers.timeManager.getServerTimeOffset();await C(g>b?1e3*b:1e3*g|0)}}catch(t){switch(t.type){case"SESSION_PASSWORD_NEEDED":t.handled=!0,L(()=>import("./pagePassword-BUHj7bf5.js"),__vite__mapDeps([13,1,2,3,4,6,14,7,15]),import.meta.url).then(c=>c.default.mount()),h=!0,_=null;break;default:console.error("pageSignQR: default error:",t),h=!0;break}return!0}return!1};return async()=>{h=!1;do if(h||await D(!0))break;while(!0)}};let _;const O=new j("page-signQR",!0,()=>_,()=>{_||(_=Z()),_.then(e=>{e()}),u.managers.appStateManager.pushToState("authState",{_:"authStateSignQr"})}),oe=Object.freeze(Object.defineProperty({__proto__:null,default:O},Symbol.toStringTag,{value:"Module"}));export{oe as a,Y as g,O as p};
//# sourceMappingURL=pageSignQR-99Bv1MS4.js.map
